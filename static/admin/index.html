<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: 50px auto; padding: 20px; text-align: center; }
    .container { background: #f5f5f5; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .btn { padding: 12px 24px; font-size: 16px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 10px; }
    .btn:hover { background: #0056b3; }
    .test-btn { background: #28a745; margin: 5px; padding: 8px 16px; font-size: 14px; }
    .config-btn { background: #ffc107; color: #000; }
    .error { color: red; margin: 10px 0; }
    .success { color: green; margin: 10px 0; }
    .warning { color: orange; margin: 10px 0; }
    input { padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 4px; width: 300px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéØ Content Management System</h1>
    
    <div id="status"><p>Checking Auth0 configuration...</p></div>
    
    <div id="config-section">
      <h2>üîß Auth0 Configuration</h2>
      <p class="warning"><strong>‚ö†Ô∏è Auth0 Domain Issue Detected!</strong></p>
      <p>The domain <code>dev-5wlo4h3teyq8jqp2.us.auth0.com</code> returned <strong>404 Not Found</strong>.</p>
      
      <h3>üîç Please Check Your Auth0 Settings:</h3>
      <div style="text-align: left; max-width: 500px; margin: 0 auto;">
        <label><strong>Auth0 Domain:</strong></label><br>
        <input type="text" id="auth0-domain" value="dev-5wlo4h3teyq8jqp2.us.auth0.com" placeholder="your-tenant.auth0.com">
        <br><br>
        
        <label><strong>Client ID:</strong></label><br>
        <input type="text" id="auth0-client" value="kBol7fUIHcILScKTPunQkZiraRaXTuG6" placeholder="Your Auth0 Client ID">
        <br><br>
        
        <button id="test-domain" class="btn config-btn">üîç Test Domain</button>
        <button id="test-wellknown" class="btn config-btn">üîó Check .well-known</button>
        <button id="update-config" class="btn config-btn">üíæ Update & Test</button>
      </div>
      
      <hr>
      
      <h3>üìã How to Find Your Correct Auth0 Domain:</h3>
      <ol style="text-align: left; max-width: 500px; margin: 0 auto;">
        <li>Go to your <a href="https://manage.auth0.com/" target="_blank">Auth0 Dashboard</a></li>
        <li>Look at the URL or top-right corner</li>
        <li>Your domain should be like: <code>your-tenant.auth0.com</code> or <code>your-tenant.us.auth0.com</code></li>
        <li>Copy the domain (without https://)</li>
        <li>Paste it above and click "Test Domain"</li>
      </ol>
    </div>
    
    <div id="login-section" style="display: none;">
      <h2>Please authenticate to access the CMS</h2>
      <button id="auth0-login" class="btn">üîê Login with Auth0</button>
      <br><br>
      <button id="manual-login" class="btn test-btn">üåê Manual Auth URL</button>
      <button id="show-config" class="btn test-btn">‚öôÔ∏è Show Config</button>
    </div>
    
    <div id="cms-section" style="display: none;">
      <h2>‚úÖ Authenticated Successfully!</h2>
      <div id="user-info"></div>
      <button id="logout-btn" class="btn">Logout</button>
      <hr><div id="cms-container"></div>
    </div>
    
    <div id="debug-info" style="margin-top: 20px; padding: 10px; background: #f0f0f0; border-radius: 5px; font-size: 12px; text-align: left; max-height: 300px; overflow-y: auto;">
      <strong>üîç Debug Info:</strong>
      <div id="debug-log"></div>
    </div>
  </div>

  <script>
    let auth0;
    let authConfig = {
      domain: 'dev-5wlo4h3teyq8jqp2.us.auth0.com',
      clientID: 'kBol7fUIHcILScKTPunQkZiraRaXTuG6',
      redirectUri: window.location.origin + '/admin/',
      responseType: 'token id_token',
      scope: 'openid profile email'
    };
    
    function log(message) {
      console.log(message);
      const debugLog = document.getElementById('debug-log');
      debugLog.innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + message;
      debugLog.scrollTop = debugLog.scrollHeight;
    }

    function showStatus(message, isError = false, isWarning = false) {
      const status = document.getElementById('status');
      const className = isError ? 'error' : (isWarning ? 'warning' : 'success');
      status.innerHTML = '<p class="' + className + '">' + message + '</p>';
    }

    function showConfig() {
      document.getElementById('config-section').style.display = 'block';
      document.getElementById('login-section').style.display = 'none';
      document.getElementById('cms-section').style.display = 'none';
      showStatus('‚ö†Ô∏è Please configure your Auth0 domain first', false, true);
    }

    function showLogin() {
      document.getElementById('config-section').style.display = 'none';
      document.getElementById('login-section').style.display = 'block';
      document.getElementById('cms-section').style.display = 'none';
      showStatus('Please login to continue');
    }

    function showCMS(user) {
      document.getElementById('config-section').style.display = 'none';
      document.getElementById('login-section').style.display = 'none';
      document.getElementById('cms-section').style.display = 'block';
      document.getElementById('user-info').innerHTML = 
        '<p>Welcome, <strong>' + (user.name || user.email) + '</strong>!</p>';
      showStatus('‚úÖ Authenticated successfully!');
    }

    function testAuth0Domain(domain) {
      log('üîç Testing Auth0 domain: ' + domain);
      
      // Test .well-known endpoint
      const wellKnownUrl = 'https://' + domain + '/.well-known/jwks.json';
      
      fetch(wellKnownUrl, { mode: 'no-cors' })
        .then(() => {
          log('‚úÖ Domain appears to be valid (no CORS error)');
          showStatus('‚úÖ Domain appears to be accessible', false);
        })
        .catch((error) => {
          log('‚ùå Domain test failed: ' + error.message);
          showStatus('‚ùå Domain not accessible: ' + error.message, true);
        });
      
      // Also test with a simple image request trick
      const img = new Image();
      img.onload = function() {
        log('‚úÖ Domain is reachable');
      };
      img.onerror = function() {
        log('‚ùå Domain is not reachable');
      };
      img.src = 'https://' + domain + '/favicon.ico?' + Math.random();
    }

    function createAuthURL() {
      const authUrl = 'https://' + authConfig.domain + '/authorize?' + 
        'response_type=' + encodeURIComponent(authConfig.responseType) + '&' +
        'client_id=' + encodeURIComponent(authConfig.clientID) + '&' +
        'redirect_uri=' + encodeURIComponent(authConfig.redirectUri) + '&' +
        'scope=' + encodeURIComponent(authConfig.scope) + '&' +
        'state=' + Math.random().toString(36).substring(7);
      return authUrl;
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      log('üöÄ Page loaded');
      log('‚ùå Auth0 Domain Issue Detected: dev-5wlo4h3teyq8jqp2.us.auth0.com returns 404');
      
      showConfig();
      
      // Setup event listeners
      document.getElementById('test-domain').addEventListener('click', function() {
        const domain = document.getElementById('auth0-domain').value.trim();
        if (domain) {
          testAuth0Domain(domain);
        } else {
          showStatus('‚ùå Please enter a domain', true);
        }
      });
      
      document.getElementById('test-wellknown').addEventListener('click', function() {
        const domain = document.getElementById('auth0-domain').value.trim();
        if (domain) {
          const wellKnownUrl = 'https://' + domain + '/.well-known/jwks.json';
          log('üîó Opening .well-known URL: ' + wellKnownUrl);
          window.open(wellKnownUrl, '_blank');
        }
      });
      
      document.getElementById('update-config').addEventListener('click', function() {
        const domain = document.getElementById('auth0-domain').value.trim();
        const clientID = document.getElementById('auth0-client').value.trim();
        
        if (!domain || !clientID) {
          showStatus('‚ùå Please enter both domain and client ID', true);
          return;
        }
        
        // Update config
        authConfig.domain = domain;
        authConfig.clientID = clientID;
        
        log('üîÑ Updated config - Domain: ' + domain + ', Client: ' + clientID);
        
        // Test the new configuration
        testAuth0Domain(domain);
        
        // If test passes, show login
        setTimeout(function() {
          showLogin();
        }, 2000);
      });
      
      document.getElementById('auth0-login').addEventListener('click', function() {
        log('üî• Login button clicked');
        const authUrl = createAuthURL();
        log('üåê Auth URL: ' + authUrl);
        window.location.href = authUrl;
      });
      
      document.getElementById('manual-login').addEventListener('click', function() {
        const authUrl = createAuthURL();
        log('üåê Manual auth URL: ' + authUrl);
        window.open(authUrl, '_blank');
      });
      
      document.getElementById('show-config').addEventListener('click', function() {
        showConfig();
      });
      
      document.getElementById('logout-btn').addEventListener('click', function() {
        localStorage.clear();
        showConfig();
      });
      
      // Check for auth result in URL
      const hash = window.location.hash;
      if (hash) {
        log('üîç Found auth result in URL');
        // Simple manual parsing since Auth0 SDK has issues
        const params = new URLSearchParams(hash.substring(1));
        const accessToken = params.get('access_token');
        const idToken = params.get('id_token');
        
        if (accessToken && idToken) {
          log('üéâ Authentication successful!');
          // Decode the ID token manually (basic)
          try {
            const payload = JSON.parse(atob(idToken.split('.')[1]));
            localStorage.setItem('auth0_user', JSON.stringify(payload));
            window.location.hash = '';
            showCMS(payload);
          } catch (error) {
            log('‚ùå Error parsing token: ' + error.message);
            showConfig();
          }
        }
      }
    });
  </script>
</body>
</html>
